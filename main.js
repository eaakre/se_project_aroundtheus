!function(){"use strict";class e{constructor(e,t,s,i,r){let{name:n,link:o,_id:a,isLiked:l}=e;this._name=n,this._link=o,this._id=a,this._isLiked=l,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteClick=i,this._handleLikeClick=r}_getCardElement(){return this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".cards__list-item").cloneNode(!0)}_setEventsListeners(){this._cardImage.addEventListener("click",(()=>{this._handleImageClick({name:this._name,url:this._link})})),this._likeButton.addEventListener("click",(()=>{this._handleLikeClick(this)})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteClick(this)}))}handleDeleteCard=()=>{this._cardElement.remove(),this._cardElement=null};setIsLiked(e){this._isLiked=e,this._renderLikes()}isLiked(){return this._isLiked}_renderLikes(){this._isLiked?this._likeButton.classList.add("cards__favorite_active"):this._likeButton.classList.remove("cards__favorite_active")}getView(){return this._cardElement=this._getCardElement(),this._cardTitle=this._cardElement.querySelector(".cards__title"),this._cardImage=this._cardElement.querySelector(".cards__image"),this._likeButton=this._cardElement.querySelector(".cards__favorite"),this._deleteButton=this._cardElement.querySelector(".cards__delete-button"),this._cardImage.src=this._link,this._cardTitle.textContent=this._name,this._cardImage.alt=this._name,this._setEventsListeners(),this._isLiked&&this._likeButton.classList.add("cards__favorite_active"),this._cardElement}}class t{constructor(e,t){let{data:s,renderer:i}=e;this._items=s,this._renderer=i,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}renderItems(){this.clear(),this._items.reverse().forEach(this._renderer)}}class s{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popupElement.addEventListener("click",(e=>{(e.target.classList.contains("modal_opened")||e.target.classList.contains("modal__close"))&&this.close()}))}}class i extends s{constructor(e,t){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form"),this._inputList=this._popupElement.querySelectorAll(".form__input"),this._handleFormSubmit=t,this._popupSubmit=this._popupElement.querySelector(".modal__button")}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setSubmitText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._popupSubmit.textContent=e?t:"Save"}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())})),super.setEventListeners()}close(){super.close(),this._popupForm.reset()}}class r{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showInputError(e,t){const s=this._form.querySelector(`.${e.id}-error`);e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(`.${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_toggleButtonState(){if(this._hasInvalidInput(this._inputList))return this.disableButton();this._enableButton()}disableButton(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}_enableButton(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}_hasInvalidInput(){return!this._inputList.every((e=>e.validity.valid))}_checkValidity(e){if(!e.validity.valid)return this._showInputError(e,e.validationMessage);this._hideInputError(e)}_setEventListeners(){this._inputList=[...this._form.querySelectorAll(this._inputSelector)],this._submitButton=this._form.querySelector(this._submitButtonSelector),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}const n={formSelector:".modal__form",inputSelector:".form__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"},o=document.querySelector("#profile-edit-modal"),a=document.forms["edit-form"],l=document.forms["add-form"],c=document.forms["update-avatar-form"],d=document.querySelector(".profile__edit-button"),u=document.querySelector(".profile__add-button"),h=(document.querySelectorAll(".cards__delete-button"),document.querySelector(".profile__avatar-edit")),_=o.querySelector(".form__input_name"),m=o.querySelector(".form__input_description");let p,v;function b(e){const t=E(e);p.addItem(t)}function f(e,t){B.open(e,t)}function S(e){e.isLiked()?k.removeLikeCard(e._id).then((t=>{e.setIsLiked(t.isLiked)})).catch((e=>{console.error(e)})):k.likeCard(e._id).then((t=>{e.setIsLiked(t.isLiked)})).catch((e=>{console.error(e)}))}const E=t=>new e(t,"#cards__list-item",f,x,S).getView(),L=new class{constructor(e){let{userName:t,userAbout:s,userAvatar:i}=e;this._userName=document.querySelector(t),this._userAbout=document.querySelector(s),this._userAvatar=document.querySelector(i)}getUserInfo(){return{name:this._userName.textContent,about:this._userAbout.textContent}}setUserInfo(e){this._userName.textContent=e.name,this._userAbout.textContent=e.about,this._userAvatar.alt=e.name+" avatar"}setUserAvatar(e,t){this._userAvatar.src=e}}({userName:".profile__title",userAbout:".profile__description",userAvatar:".profile__avatar"}),k=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._authorization=s.authorization,this._contentType=s["Content-Type"],this._headers=s}_checkResponse(e){if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUser(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}updateProfile(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",body:JSON.stringify({name:e.name,about:e.about}),headers:this._headers}).then(this._checkResponse)}addCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",body:JSON.stringify({name:e,link:t}),headers:this._headers}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateProfilePicture(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a93ebd2f-fd06-499f-b2f9-74e2f8519709","Content-Type":"application/json"}});Promise.all([k.getUser(),k.getInitialCards()]).then((e=>{let[s,i]=e;L.setUserInfo({name:s.name,about:s.about}),L.setUserAvatar(s.avatar,s.name),p=new t({data:i,renderer:b},".cards__list"),p.renderItems()})).catch((e=>console.log(e))),new r(n,a).enableValidation();const C=new r(n,l);C.enableValidation();const y=new r(n,c);y.enableValidation();const g=new i("#profile-edit-modal",(e=>{g.setSubmitText(!0),k.updateProfile(e).then((e=>{L.setUserInfo(e),g.close()})).catch((e=>console.log(e))).finally((()=>g.setSubmitText(!1)))}));g.setEventListeners(),d.addEventListener("click",(()=>{g.open();const e=L.getUserInfo();_.value=e.name,m.value=e.about}));const I=new i("#profile-add-modal",(e=>{let{title:t,image:s}=e;I.setSubmitText(!0),k.addCard(t,s).then((e=>{v=E({name:e.name,link:e.link,_id:e._id,isLiked:!1}),p.addItem(v),I.close()})).catch((e=>console.log(e))).finally((()=>I.setSubmitText(!1)))}));I.setEventListeners(),u.addEventListener("click",(()=>{C.disableButton(),I.open()}));const q=new i("#update-avatar-modal",(e=>{q.setSubmitText(!0),k.updateProfilePicture(e.image).then((e=>{L.setUserAvatar(e.avatar),q.close()})).catch((e=>console.log(e))).finally((()=>q.setSubmitText(!1)))}));q.setEventListeners(),h.addEventListener("click",(()=>{y.disableButton(),q.open()}));const B=new class extends s{constructor(e){super({popupSelector:e}),this._cardImage=document.querySelector(".modal__image"),this._cardTitle=document.querySelector(".modal__title")}open(e){this._cardImage.src=e.url,this._cardTitle.textContent=e.title,this._cardImage.alt=e.title,super.open()}}("#card-modal");B.setEventListeners();const T=new class extends s{constructor(e){super({popupSelector:e}),this._popupConfirm=this._popupElement.querySelector(".modal__form"),this._popupSubmit=this._popupElement.querySelector(".modal__button")}setEventListeners(){this._popupConfirm.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit()})),super.setEventListeners()}setSubmitText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._popupSubmit.textContent=e?t:"Yes"}setSubmitAction(e){this._handleSubmit=e}}("#delete-card-modal");function x(e){T.open(),T.setSubmitAction((()=>{T.setSubmitText(!0,"Deleting..."),k.deleteCard(e._id).then((()=>{T.close(),e.handleDeleteCard()})).catch((e=>console.error(e))).finally((()=>T.setSubmitText(!1)))}))}T.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQWUsTUFBTUEsRUFDbkJDLFdBQUFBLENBQVdDLEVBRVRDLEVBQ0FDLEVBQ0FDLEVBQ0FDLEdBQ0EsSUFMQSxLQUFFQyxFQUFJLEtBQUVDLEVBQUksSUFBRUMsRUFBRyxRQUFFQyxHQUFTUixFQU01QlMsS0FBS0MsTUFBUUwsRUFDYkksS0FBS0UsTUFBUUwsRUFDYkcsS0FBS0YsSUFBTUEsRUFDWEUsS0FBS0csU0FBV0osRUFDaEJDLEtBQUtJLGNBQWdCWixFQUNyQlEsS0FBS0ssa0JBQW9CWixFQUN6Qk8sS0FBS00sbUJBQXFCWixFQUMxQk0sS0FBS08saUJBQW1CWixDQUMxQixDQUVBYSxlQUFBQSxHQUNFLE9BQVFSLEtBQUtTLGFBQWVDLFNBQ3pCQyxjQUFjWCxLQUFLSSxlQUNuQlEsUUFBUUQsY0FBYyxxQkFDdEJFLFdBQVUsRUFDZixDQUNBQyxtQkFBQUEsR0FDRWQsS0FBS2UsV0FBV0MsaUJBQWlCLFNBQVMsS0FDeENoQixLQUFLSyxrQkFBa0IsQ0FBRVQsS0FBTUksS0FBS0MsTUFBT2dCLElBQUtqQixLQUFLRSxPQUFRLElBRy9ERixLQUFLa0IsWUFBWUYsaUJBQWlCLFNBQVMsS0FDekNoQixLQUFLTyxpQkFBaUJQLEtBQUssSUFFN0JBLEtBQUttQixjQUFjSCxpQkFBaUIsU0FBUyxLQUMzQ2hCLEtBQUtNLG1CQUFtQk4sS0FBSyxHQUVqQyxDQUVBb0IsaUJBQW1CQSxLQUNqQnBCLEtBQUtTLGFBQWFZLFNBQ2xCckIsS0FBS1MsYUFBZSxJQUFJLEVBRzFCYSxVQUFBQSxDQUFXQyxHQUNUdkIsS0FBS0csU0FBV29CLEVBQ2hCdkIsS0FBS3dCLGNBQ1AsQ0FFQXpCLE9BQUFBLEdBQ0UsT0FBT0MsS0FBS0csUUFDZCxDQUVBcUIsWUFBQUEsR0FDTXhCLEtBQUtHLFNBQ1BILEtBQUtrQixZQUFZTyxVQUFVQyxJQUFJLDBCQUUvQjFCLEtBQUtrQixZQUFZTyxVQUFVSixPQUFPLHlCQUV0QyxDQUVBTSxPQUFBQSxHQW1CRSxPQWxCQTNCLEtBQUtTLGFBQWVULEtBQUtRLGtCQUV6QlIsS0FBSzRCLFdBQWE1QixLQUFLUyxhQUFhRSxjQUFjLGlCQUVsRFgsS0FBS2UsV0FBYWYsS0FBS1MsYUFBYUUsY0FBYyxpQkFDbERYLEtBQUtrQixZQUFjbEIsS0FBS1MsYUFBYUUsY0FBYyxvQkFDbkRYLEtBQUttQixjQUFnQm5CLEtBQUtTLGFBQWFFLGNBQ3JDLHlCQUdGWCxLQUFLZSxXQUFXYyxJQUFNN0IsS0FBS0UsTUFDM0JGLEtBQUs0QixXQUFXRSxZQUFjOUIsS0FBS0MsTUFDbkNELEtBQUtlLFdBQVdnQixJQUFNL0IsS0FBS0MsTUFFM0JELEtBQUtjLHNCQUNEZCxLQUFLRyxVQUNQSCxLQUFLa0IsWUFBWU8sVUFBVUMsSUFBSSwwQkFFMUIxQixLQUFLUyxZQUNkLEVDL0VhLE1BQU11QixFQUNuQjFDLFdBQUFBLENBQVdDLEVBQXFCMEMsR0FBVSxJQUE5QixLQUFFQyxFQUFJLFNBQUVDLEdBQVU1QyxFQUM1QlMsS0FBS29DLE9BQVNGLEVBQ2RsQyxLQUFLcUMsVUFBWUYsRUFDakJuQyxLQUFLc0MsV0FBYTVCLFNBQVNDLGNBQWNzQixFQUMzQyxDQUVBTSxPQUFBQSxDQUFRQyxHQUNOeEMsS0FBS3NDLFdBQVdHLFFBQVFELEVBQzFCLENBRUFFLEtBQUFBLEdBQ0UxQyxLQUFLc0MsV0FBV0ssVUFBWSxFQUM5QixDQUVBQyxXQUFBQSxHQUNFNUMsS0FBSzBDLFFBQ0wxQyxLQUFLb0MsT0FBT1MsVUFBVUMsUUFBUTlDLEtBQUtxQyxVQUNyQyxFQ2xCYSxNQUFNVSxFQUNuQnpELFdBQUFBLENBQVdDLEdBQW9CLElBQW5CLGNBQUV5RCxHQUFlekQsRUFDM0JTLEtBQUtpRCxjQUFnQnZDLFNBQVNDLGNBQWNxQyxFQUM5QyxDQUVBRSxJQUFBQSxHQUNFbEQsS0FBS2lELGNBQWN4QixVQUFVQyxJQUFJLGdCQUNqQ2hCLFNBQVNNLGlCQUFpQixVQUFXaEIsS0FBS21ELGdCQUM1QyxDQUVBQyxLQUFBQSxHQUNFcEQsS0FBS2lELGNBQWN4QixVQUFVSixPQUFPLGdCQUNwQ1gsU0FBUzJDLG9CQUFvQixVQUFXckQsS0FBS21ELGdCQUMvQyxDQUVBQSxnQkFBbUJHLElBQ0gsV0FBVkEsRUFBRUMsS0FDSnZELEtBQUtvRCxPQUNQLEVBR0ZJLGlCQUFBQSxHQUNFeEQsS0FBS2lELGNBQWNqQyxpQkFBaUIsU0FBVXNDLEtBRTFDQSxFQUFFRyxPQUFPaEMsVUFBVWlDLFNBQVMsaUJBQzVCSixFQUFFRyxPQUFPaEMsVUFBVWlDLFNBQVMsa0JBRTVCMUQsS0FBS29ELE9BQ1AsR0FFSixFQzVCYSxNQUFNTyxVQUFzQlosRUFDekN6RCxXQUFBQSxDQUFZMEQsRUFBZVksR0FDekJDLE1BQU0sQ0FBRWIsa0JBQ1JoRCxLQUFLOEQsV0FBYTlELEtBQUtpRCxjQUFjdEMsY0FBYyxnQkFDbkRYLEtBQUsrRCxXQUFhL0QsS0FBS2lELGNBQWNlLGlCQUFpQixnQkFDdERoRSxLQUFLaUUsa0JBQW9CTCxFQUN6QjVELEtBQUtrRSxhQUFlbEUsS0FBS2lELGNBQWN0QyxjQUFjLGlCQUN2RCxDQUVBd0QsZUFBQUEsR0FDRSxNQUFNakMsRUFBTyxDQUFDLEVBSWQsT0FIQWxDLEtBQUsrRCxXQUFXakIsU0FBU3NCLElBQ3ZCbEMsRUFBS2tDLEVBQU14RSxNQUFRd0UsRUFBTUMsS0FBSyxJQUV6Qm5DLENBQ1QsQ0FFQW9DLGFBQUFBLENBQWNDLEdBQWtDLElBQTFCQyxFQUFVQyxVQUFBQyxPQUFBLFFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFHLFlBRS9CekUsS0FBS2tFLGFBQWFwQyxZQURoQnlDLEVBQzhCQyxFQUVBLE1BRXBDLENBRUFoQixpQkFBQUEsR0FDRXhELEtBQUs4RCxXQUFXOUMsaUJBQWlCLFVBQVdzQyxJQUMxQ0EsRUFBRXNCLGlCQUNGNUUsS0FBS2lFLGtCQUFrQmpFLEtBQUttRSxrQkFBa0IsSUFFaEROLE1BQU1MLG1CQUNSLENBRUFKLEtBQUFBLEdBQ0VTLE1BQU1ULFFBQ05wRCxLQUFLOEQsV0FBV2UsT0FDbEIsRUN0Q2EsTUFBTUMsRUFDbkJ4RixXQUFBQSxDQUFZeUYsRUFBVUMsR0FDcEJoRixLQUFLaUYsZUFBaUJGLEVBQVNHLGNBQy9CbEYsS0FBS21GLHNCQUF3QkosRUFBU0sscUJBQ3RDcEYsS0FBS3FGLHFCQUF1Qk4sRUFBU08sb0JBQ3JDdEYsS0FBS3VGLGlCQUFtQlIsRUFBU1MsZ0JBQ2pDeEYsS0FBS3lGLFlBQWNWLEVBQVNXLFdBQzVCMUYsS0FBSzJGLE1BQVFYLENBQ2YsQ0FFQVksZUFBQUEsQ0FBZ0JDLEVBQWNDLEdBQzVCLE1BQU1DLEVBQWUvRixLQUFLMkYsTUFBTWhGLGNBQWUsSUFBR2tGLEVBQWFHLFlBQy9ESCxFQUFhcEUsVUFBVUMsSUFBSTFCLEtBQUt1RixrQkFDaENRLEVBQWFqRSxZQUFjZ0UsRUFDM0JDLEVBQWF0RSxVQUFVQyxJQUFJMUIsS0FBS3lGLFlBQ2xDLENBRUFRLGVBQUFBLENBQWdCSixHQUNkLE1BQU1FLEVBQWUvRixLQUFLMkYsTUFBTWhGLGNBQWUsSUFBR2tGLEVBQWFHLFlBQy9ESCxFQUFhcEUsVUFBVUosT0FBT3JCLEtBQUt1RixrQkFDbkNRLEVBQWFqRSxZQUFjLEdBQzNCaUUsRUFBYXRFLFVBQVVKLE9BQU9yQixLQUFLeUYsWUFDckMsQ0FFQVMsa0JBQUFBLEdBQ0UsR0FBSWxHLEtBQUttRyxpQkFBaUJuRyxLQUFLK0QsWUFDN0IsT0FBTy9ELEtBQUtvRyxnQkFFZHBHLEtBQUtxRyxlQUNQLENBRUFELGFBQUFBLEdBQ0VwRyxLQUFLc0csY0FBYzdFLFVBQVVDLElBQUkxQixLQUFLcUYsc0JBQ3RDckYsS0FBS3NHLGNBQWNDLFVBQVcsQ0FDaEMsQ0FFQUYsYUFBQUEsR0FDRXJHLEtBQUtzRyxjQUFjN0UsVUFBVUosT0FBT3JCLEtBQUtxRixzQkFDekNyRixLQUFLc0csY0FBY0MsVUFBVyxDQUNoQyxDQUVBSixnQkFBQUEsR0FDRSxPQUFRbkcsS0FBSytELFdBQVd5QyxPQUNyQlgsR0FBaUJBLEVBQWFZLFNBQVNDLE9BRTVDLENBRUFDLGNBQUFBLENBQWVkLEdBQ2IsSUFBS0EsRUFBYVksU0FBU0MsTUFDekIsT0FBTzFHLEtBQUs0RixnQkFBZ0JDLEVBQWNBLEVBQWFlLG1CQUV6RDVHLEtBQUtpRyxnQkFBZ0JKLEVBQ3ZCLENBRUFnQixrQkFBQUEsR0FDRTdHLEtBQUsrRCxXQUFhLElBQUkvRCxLQUFLMkYsTUFBTTNCLGlCQUFpQmhFLEtBQUtpRixpQkFDdkRqRixLQUFLc0csY0FBZ0J0RyxLQUFLMkYsTUFBTWhGLGNBQWNYLEtBQUttRix1QkFDbkRuRixLQUFLK0QsV0FBV2pCLFNBQVMrQyxJQUN2QkEsRUFBYTdFLGlCQUFpQixTQUFTLEtBQ3JDaEIsS0FBSzJHLGVBQWVkLEdBQ3BCN0YsS0FBS2tHLG9CQUFvQixHQUN6QixHQUVOLENBRUFZLGdCQUFBQSxHQUNFOUcsS0FBSzJGLE1BQU0zRSxpQkFBaUIsVUFBVytGLElBQ3JDQSxFQUFJbkMsZ0JBQWdCLElBRXRCNUUsS0FBSzZHLG9CQUNQLEVDdEVLLE1BMkJNRyxFQUFTLENBQ3BCQyxhQUFjLGVBQ2QvQixjQUFlLGVBQ2ZFLHFCQUFzQixpQkFDdEJFLG9CQUFxQix5QkFDckJFLGdCQUFpQix5QkFDakJFLFdBQVksdUJBSUR3QixFQUFtQnhHLFNBQVNDLGNBQWMsdUJBRzFDd0csRUFBa0J6RyxTQUFTMEcsTUFBTSxhQUNqQ0MsRUFBYzNHLFNBQVMwRyxNQUFNLFlBQzdCRSxFQUFhNUcsU0FBUzBHLE1BQU0sc0JBRzVCRyxFQUFvQjdHLFNBQVNDLGNBQ3hDLHlCQUVXNkcsRUFBbUI5RyxTQUFTQyxjQUFjLHdCQUkxQzhHLEdBSG9CL0csU0FBU3NELGlCQUN4Qyx5QkFFK0J0RCxTQUFTQyxjQUN4QywwQkFJVytHLEVBQVlSLEVBQWlCdkcsY0FBYyxxQkFDM0NnSCxFQUFtQlQsRUFBaUJ2RyxjQUMvQyw0QkN0Q0YsSUFBSWlILEVBQ0FDLEVBR0osU0FBU0MsRUFBVzVGLEdBQ2xCLE1BQU02RixFQUFjQyxFQUFXOUYsR0FDL0IwRixFQUFTckYsUUFBUXdGLEVBQ25CLENBRU8sU0FBU3RJLEVBQWlCRyxFQUFNQyxHQUNyQ29JLEVBQVUvRSxLQUFLdEQsRUFBTUMsRUFDdkIsQ0FHQSxTQUFTRixFQUFnQnVJLEdBQ2xCQSxFQUFLbkksVUFVUm9JLEVBQ0dDLGVBQWVGLEVBQUtwSSxLQUNwQnVJLE1BQU1DLElBQ0xKLEVBQUs1RyxXQUFXZ0gsRUFBSXZJLFFBQVEsSUFFN0J3SSxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLElBZnRCTCxFQUNHUSxTQUFTVCxFQUFLcEksS0FDZHVJLE1BQU1DLElBQ0xKLEVBQUs1RyxXQUFXZ0gsRUFBSXZJLFFBQVEsSUFFN0J3SSxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLEdBWTFCLENBRUEsTUFBTVIsRUFBY1ksR0FDTCxJQUFJdkosRUFDZnVKLEVBQ0Esb0JBQ0FuSixFQUNBQyxFQUNBQyxHQUVVZ0MsVUFJUmtILEVBQVcsSUNyRUYsTUFDYnZKLFdBQUFBLENBQVdDLEdBQXNDLElBQXJDLFNBQUV1SixFQUFRLFVBQUVDLEVBQVMsV0FBRUMsR0FBWXpKLEVBQzdDUyxLQUFLaUosVUFBWXZJLFNBQVNDLGNBQWNtSSxHQUN4QzlJLEtBQUtrSixXQUFheEksU0FBU0MsY0FBY29JLEdBQ3pDL0ksS0FBS21KLFlBQWN6SSxTQUFTQyxjQUFjcUksRUFDNUMsQ0FFQUksV0FBQUEsR0FDRSxNQUFPLENBQ0x4SixLQUFNSSxLQUFLaUosVUFBVW5ILFlBQ3JCdUgsTUFBT3JKLEtBQUtrSixXQUFXcEgsWUFFM0IsQ0FFQXdILFdBQUFBLENBQVlwSCxHQUNWbEMsS0FBS2lKLFVBQVVuSCxZQUFjSSxFQUFLdEMsS0FDbENJLEtBQUtrSixXQUFXcEgsWUFBY0ksRUFBS21ILE1BQ25DckosS0FBS21KLFlBQVlwSCxJQUFNRyxFQUFLdEMsS0FBTyxTQUNyQyxDQUVBMkosYUFBQUEsQ0FBY0MsRUFBTzVKLEdBQ25CSSxLQUFLbUosWUFBWXRILElBQU0ySCxDQUN6QixHRCtDNEIsQ0FDNUJWLFNBQVUsa0JBQ1ZDLFVBQVcsd0JBQ1hDLFdBQVkscUJBSVJiLEVBQU0sSUU1RUcsTUFDYjdJLFdBQUFBLENBQVdDLEdBQXVCLElBQXRCLFFBQUVrSyxFQUFPLFFBQUVDLEdBQVNuSyxFQUU5QlMsS0FBSzJKLFNBQVdGLEVBQ2hCekosS0FBSzRKLGVBQWlCRixFQUFRRyxjQUM5QjdKLEtBQUs4SixhQUFlSixFQUFRLGdCQUM1QjFKLEtBQUsrSixTQUFXTCxDQUNsQixDQUVBTSxjQUFBQSxDQUFlMUIsR0FDYixHQUFJQSxFQUFJMkIsR0FDTixPQUFPM0IsRUFBSTRCLE9BQ05DLFFBQVFDLE9BQVEsVUFBUzlCLEVBQUkrQixTQUN0QyxDQUVBQyxlQUFBQSxHQUNFLE9BQU9DLE1BQU8sR0FBRXZLLEtBQUsySixpQkFBa0IsQ0FDckNELFFBQVMxSixLQUFLK0osV0FDYjFCLEtBQUtySSxLQUFLZ0ssZUFDZixDQUdBUSxPQUFBQSxHQUNFLE9BQU9ELE1BQU8sR0FBRXZLLEtBQUsySixvQkFBcUIsQ0FDeENELFFBQVMxSixLQUFLK0osV0FDYjFCLEtBQUtySSxLQUFLZ0ssZUFDZixDQUVBUyxhQUFBQSxDQUFjdkksR0FDWixPQUFPcUksTUFBTyxHQUFFdkssS0FBSzJKLG9CQUFxQixDQUN4Q2UsT0FBUSxRQUNSQyxLQUFNQyxLQUFLQyxVQUFVLENBQ25CakwsS0FBTXNDLEVBQUt0QyxLQUNYeUosTUFBT25ILEVBQUttSCxRQUVkSyxRQUFTMUosS0FBSytKLFdBQ2IxQixLQUFLckksS0FBS2dLLGVBQ2YsQ0FFQWMsT0FBQUEsQ0FBUUMsRUFBT2xMLEdBQ2IsT0FBTzBLLE1BQU8sR0FBRXZLLEtBQUsySixpQkFBa0IsQ0FDckNlLE9BQVEsT0FDUkMsS0FBTUMsS0FBS0MsVUFBVSxDQUNuQmpMLEtBQU1tTCxFQUNObEwsS0FBTUEsSUFFUjZKLFFBQVMxSixLQUFLK0osV0FDYjFCLEtBQUtySSxLQUFLZ0ssZUFDZixDQUVBZ0IsVUFBQUEsQ0FBV2hGLEdBQ1QsT0FBT3VFLE1BQU8sR0FBRXZLLEtBQUsySixrQkFBa0IzRCxJQUFNLENBQzNDMEUsT0FBUSxTQUNSaEIsUUFBUzFKLEtBQUsrSixXQUNiMUIsS0FBS3JJLEtBQUtnSyxlQUNmLENBRUFyQixRQUFBQSxDQUFTM0MsR0FDUCxPQUFPdUUsTUFBTyxHQUFFdkssS0FBSzJKLGtCQUFrQjNELFVBQVksQ0FDakQwRSxPQUFRLE1BQ1JoQixRQUFTMUosS0FBSytKLFdBQ2IxQixLQUFLckksS0FBS2dLLGVBQ2YsQ0FFQTVCLGNBQUFBLENBQWVwQyxHQUNiLE9BQU91RSxNQUFPLEdBQUV2SyxLQUFLMkosa0JBQWtCM0QsVUFBWSxDQUNqRDBFLE9BQVEsU0FDUmhCLFFBQVMxSixLQUFLK0osV0FDYjFCLEtBQUtySSxLQUFLZ0ssZUFDZixDQUVBaUIsb0JBQUFBLENBQXFCcEwsR0FDbkIsT0FBTzBLLE1BQU8sR0FBRXZLLEtBQUsySiwyQkFBNEIsQ0FDL0NlLE9BQVEsUUFDUmhCLFFBQVMxSixLQUFLK0osU0FDZFksS0FBTUMsS0FBS0MsVUFBVSxDQUNuQkssT0FBUXJMLE1BRVR3SSxLQUFLckksS0FBS2dLLGVBQ2YsR0ZIa0IsQ0FDbEJQLFFBQVMsa0RBQ1RDLFFBQVMsQ0FDUEcsY0FBZSx1Q0FDZixlQUFnQixzQkFLcEJNLFFBQVFnQixJQUFJLENBQUNoRCxFQUFJcUMsVUFBV3JDLEVBQUltQyxvQkFDN0JqQyxNQUFLOUksSUFBbUIsSUFBakIyQyxFQUFNa0osR0FBTTdMLEVBQ2xCc0osRUFBU1MsWUFBWSxDQUFFMUosS0FBTXNDLEVBQUt0QyxLQUFNeUosTUFBT25ILEVBQUttSCxRQUNwRFIsRUFBU1UsY0FBY3JILEVBQUtnSixPQUFRaEosRUFBS3RDLE1BQ3pDZ0ksRUFBVyxJQUFJNUYsRUFDYixDQUFFRSxLQUFNa0osRUFBT2pKLFNBQVUyRixHQUN6QixnQkFFRkYsRUFBU2hGLGFBQWEsSUFFdkIyRixPQUFPQyxHQUFRQyxRQUFRNEMsSUFBSTdDLEtBR0osSUFBSTFELEVBQWNrQyxFQUFRRyxHQUNsQ0wsbUJBRWxCLE1BQU13RSxFQUFtQixJQUFJeEcsRUFBY2tDLEVBQVFLLEdBQ25EaUUsRUFBaUJ4RSxtQkFFakIsTUFBTXlFLEVBQXNCLElBQUl6RyxFQUFja0MsRUFBUU0sR0FDdERpRSxFQUFvQnpFLG1CQUlwQixNQUFNMEUsRUFBbUIsSUFBSTdILEVBQWMsdUJBQXdCekIsSUFDakVzSixFQUFpQmxILGVBQWMsR0FDL0I2RCxFQUNHc0MsY0FBY3ZJLEdBQ2RtRyxNQUFNbkcsSUFDTDJHLEVBQVNTLFlBQVlwSCxHQUNyQnNKLEVBQWlCcEksT0FBTyxJQUV6Qm1GLE9BQU9DLEdBQVFDLFFBQVE0QyxJQUFJN0MsS0FDM0JpRCxTQUFRLElBQU1ELEVBQWlCbEgsZUFBYyxJQUFPLElBRXpEa0gsRUFBaUJoSSxvQkFHakIrRCxFQUFrQnZHLGlCQUFpQixTQUFTLEtBQzFDd0ssRUFBaUJ0SSxPQUNqQixNQUFNd0ksRUFBVzdDLEVBQVNPLGNBQzFCMUIsRUFBVXJELE1BQVFxSCxFQUFTOUwsS0FDM0IrSCxFQUFpQnRELE1BQVFxSCxFQUFTckMsS0FBSyxJQUt6QyxNQUFNc0MsRUFBZSxJQUFJaEksRUFDdkIsc0JBQ0FpSSxJQUFzQixJQUFyQixNQUFFYixFQUFLLE1BQUV2QixHQUFPb0MsRUFDZkQsRUFBYXJILGVBQWMsR0FDM0I2RCxFQUNHMkMsUUFBUUMsRUFBT3ZCLEdBQ2ZuQixNQUFNSCxJQUNMTCxFQUFVRyxFQUFXLENBQ25CcEksS0FBTXNJLEVBQUt0SSxLQUNYQyxLQUFNcUksRUFBS3JJLEtBQ1hDLElBQUtvSSxFQUFLcEksSUFDVkMsU0FBUyxJQUVYNkgsRUFBU3JGLFFBQVFzRixHQUNqQjhELEVBQWF2SSxPQUFPLElBRXJCbUYsT0FBT0MsR0FBUUMsUUFBUTRDLElBQUk3QyxLQUMzQmlELFNBQVEsSUFBTUUsRUFBYXJILGVBQWMsSUFBTyxJQUd2RHFILEVBQWFuSSxvQkFHYmdFLEVBQWlCeEcsaUJBQWlCLFNBQVMsS0FDekNzSyxFQUFpQmxGLGdCQUNqQnVGLEVBQWF6SSxNQUFNLElBS3JCLE1BQU0ySSxFQUFvQixJQUFJbEksRUFBYyx3QkFBeUI2RixJQUNuRXFDLEVBQWtCdkgsZUFBYyxHQUNoQzZELEVBQ0c4QyxxQkFBcUJ6QixFQUFNQSxPQUMzQm5CLE1BQU1xRCxJQUNMN0MsRUFBU1UsY0FBY21DLEVBQVNSLFFBQ2hDVyxFQUFrQnpJLE9BQU8sSUFFMUJtRixPQUFPQyxHQUFRQyxRQUFRNEMsSUFBSTdDLEtBQzNCaUQsU0FBUSxJQUFNSSxFQUFrQnZILGVBQWMsSUFBTyxJQUUxRHVILEVBQWtCckksb0JBR2xCaUUsRUFBa0J6RyxpQkFBaUIsU0FBUyxLQUMxQ3VLLEVBQW9CbkYsZ0JBQ3BCeUYsRUFBa0IzSSxNQUFNLElBSzFCLE1BQU0rRSxFQUFZLElHckxILGNBQTZCbEYsRUFDMUN6RCxXQUFBQSxDQUFZMEQsR0FDVmEsTUFBTSxDQUFFYixrQkFDUmhELEtBQUtlLFdBQWFMLFNBQVNDLGNBQWMsaUJBQ3pDWCxLQUFLNEIsV0FBYWxCLFNBQVNDLGNBQWMsZ0JBQzNDLENBRUF1QyxJQUFBQSxDQUFLaEIsR0FDSGxDLEtBQUtlLFdBQVdjLElBQU1LLEVBQUtqQixJQUMzQmpCLEtBQUs0QixXQUFXRSxZQUFjSSxFQUFLNkksTUFDbkMvSyxLQUFLZSxXQUFXZ0IsSUFBTUcsRUFBSzZJLE1BQzNCbEgsTUFBTVgsTUFDUixHSHlLbUMsZUFDckMrRSxFQUFVekUsb0JBR1YsTUFBTXNJLEVBQWtCLElJekxULGNBQStCL0ksRUFDNUN6RCxXQUFBQSxDQUFZMEQsR0FDVmEsTUFBTSxDQUFFYixrQkFDUmhELEtBQUsrTCxjQUFnQi9MLEtBQUtpRCxjQUFjdEMsY0FBYyxnQkFDdERYLEtBQUtrRSxhQUFlbEUsS0FBS2lELGNBQWN0QyxjQUFjLGlCQUN2RCxDQUVBNkMsaUJBQUFBLEdBQ0V4RCxLQUFLK0wsY0FBYy9LLGlCQUFpQixVQUFXc0MsSUFDN0NBLEVBQUVzQixpQkFDRjVFLEtBQUtnTSxlQUFlLElBRXRCbkksTUFBTUwsbUJBQ1IsQ0FFQWMsYUFBQUEsQ0FBY0MsR0FBa0MsSUFBMUJDLEVBQVVDLFVBQUFDLE9BQUEsUUFBQUMsSUFBQUYsVUFBQSxHQUFBQSxVQUFBLEdBQUcsWUFFL0J6RSxLQUFLa0UsYUFBYXBDLFlBRGhCeUMsRUFDOEJDLEVBRUEsS0FFcEMsQ0FFQXlILGVBQUFBLENBQWdCQyxHQUNkbE0sS0FBS2dNLGNBQWdCRSxDQUN2QixHSmdLMkMsc0JBRzdDLFNBQVN4TSxFQUFrQndJLEdBQ3pCNEQsRUFBZ0I1SSxPQUNoQjRJLEVBQWdCRyxpQkFBZ0IsS0FDOUJILEVBQWdCeEgsZUFBYyxFQUFNLGVBQ3BDNkQsRUFDRzZDLFdBQVc5QyxFQUFLcEksS0FDaEJ1SSxNQUFLLEtBQ0p5RCxFQUFnQjFJLFFBQ2hCOEUsRUFBSzlHLGtCQUFrQixJQUV4Qm1ILE9BQU9DLEdBQVFDLFFBQVFDLE1BQU1GLEtBQzdCaUQsU0FBUSxJQUFNSyxFQUFnQnhILGVBQWMsSUFBTyxHQUUxRCxDQWZBd0gsRUFBZ0J0SSxtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHsgbmFtZSwgbGluaywgX2lkLCBpc0xpa2VkIH0sXG4gICAgY2FyZFNlbGVjdG9yLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgaGFuZGxlRGVsZXRlQ2xpY2ssXG4gICAgaGFuZGxlTGlrZUNsaWNrXG4gICkge1xuICAgIHRoaXMuX25hbWUgPSBuYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBsaW5rO1xuICAgIHRoaXMuX2lkID0gX2lkO1xuICAgIHRoaXMuX2lzTGlrZWQgPSBpc0xpa2VkO1xuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayA9IGhhbmRsZURlbGV0ZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZUxpa2VDbGljayA9IGhhbmRsZUxpa2VDbGljaztcbiAgfVxuXG4gIF9nZXRDYXJkRWxlbWVudCgpIHtcbiAgICByZXR1cm4gKHRoaXMuX2NhcmRFbGVtZW50ID0gZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3QtaXRlbVwiKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKSk7XG4gIH1cbiAgX3NldEV2ZW50c0xpc3RlbmVycygpIHtcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2soeyBuYW1lOiB0aGlzLl9uYW1lLCB1cmw6IHRoaXMuX2xpbmsgfSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQ2xpY2sodGhpcyk7XG4gICAgfSk7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayh0aGlzKTtcbiAgICB9KTtcbiAgfVxuXG4gIGhhbmRsZURlbGV0ZUNhcmQgPSAoKSA9PiB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBudWxsO1xuICB9O1xuXG4gIHNldElzTGlrZWQobGlrZWRTdGF0dXMpIHtcbiAgICB0aGlzLl9pc0xpa2VkID0gbGlrZWRTdGF0dXM7XG4gICAgdGhpcy5fcmVuZGVyTGlrZXMoKTtcbiAgfVxuXG4gIGlzTGlrZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzTGlrZWQ7XG4gIH1cblxuICBfcmVuZGVyTGlrZXMoKSB7XG4gICAgaWYgKHRoaXMuX2lzTGlrZWQpIHtcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRzX19mYXZvcml0ZV9hY3RpdmVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRzX19mYXZvcml0ZV9hY3RpdmVcIik7XG4gICAgfVxuICB9XG5cbiAgZ2V0VmlldygpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldENhcmRFbGVtZW50KCk7XG5cbiAgICB0aGlzLl9jYXJkVGl0bGUgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX190aXRsZVwiKTtcblxuICAgIHRoaXMuX2NhcmRJbWFnZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2ltYWdlXCIpO1xuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19mYXZvcml0ZVwiKTtcbiAgICB0aGlzLl9kZWxldGVCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuY2FyZHNfX2RlbGV0ZS1idXR0b25cIlxuICAgICk7XG5cbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLl9jYXJkVGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSB0aGlzLl9uYW1lO1xuXG4gICAgdGhpcy5fc2V0RXZlbnRzTGlzdGVuZXJzKCk7XG4gICAgaWYgKHRoaXMuX2lzTGlrZWQpIHtcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRzX19mYXZvcml0ZV9hY3RpdmVcIik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgZGF0YSwgcmVuZGVyZXIgfSwgc2VsZWN0b3IpIHtcbiAgICB0aGlzLl9pdGVtcyA9IGRhdGE7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG5cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5fY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XG4gIH1cblxuICByZW5kZXJJdGVtcygpIHtcbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgdGhpcy5faXRlbXMucmV2ZXJzZSgpLmZvckVhY2godGhpcy5fcmVuZGVyZXIpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHsgcG9wdXBTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgX2hhbmRsZUVzY0Nsb3NlID0gKGUpID0+IHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuZWRcIikgfHxcbiAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlXCIpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5mb3JtX19pbnB1dFwiKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB0aGlzLl9wb3B1cFN1Ym1pdCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b25cIik7XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgZGF0YSA9IHt9O1xuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgZGF0YVtpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgc2V0U3VibWl0VGV4dChzdWJtaXQsIHN1Ym1pdFRleHQgPSBcIlNhdmluZy4uLlwiKSB7XG4gICAgaWYgKHN1Ym1pdCkge1xuICAgICAgdGhpcy5fcG9wdXBTdWJtaXQudGV4dENvbnRlbnQgPSBzdWJtaXRUZXh0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9wb3B1cFN1Ym1pdC50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3BvcHVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgIH0pO1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICBzdXBlci5jbG9zZSgpO1xuICAgIHRoaXMuX3BvcHVwRm9ybS5yZXNldCgpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm0pIHtcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcbiAgICB0aGlzLl9mb3JtID0gZm9ybTtcbiAgfVxuXG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfVxuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0TGlzdCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmRpc2FibGVCdXR0b24oKTtcbiAgICB9XG4gICAgdGhpcy5fZW5hYmxlQnV0dG9uKCk7XG4gIH1cblxuICBkaXNhYmxlQnV0dG9uKCkge1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gIH1cblxuICBfZW5hYmxlQnV0dG9uKCkge1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG5cbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcbiAgICByZXR1cm4gIXRoaXMuX2lucHV0TGlzdC5ldmVyeShcbiAgICAgIChpbnB1dEVsZW1lbnQpID0+IGlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZFxuICAgICk7XG4gIH1cblxuICBfY2hlY2tWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcbiAgICB9XG4gICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dExpc3QgPSBbLi4udGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja1ZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIkRpc25leSBXb3JsZFwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1OTc0NjY1OTkzNjAtM2I5Nzc1ODQxYWVjP2l4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRCZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZ3PTc2NCZxPTgwXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkdvb3NlYmVycnkgRmFsbHNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNjE4NTAyMTA1NjM0LWRkYjI4Yzc0OGRkYj9peGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0QmYXV0bz1mb3JtYXQmZml0PWNyb3Amdz02ODcmcT04MFwiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJXaWxsaXMgVG93ZXJcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTU2NDcyOTA4LTBmNzdlODE1ZDgxYj9peGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0QmYXV0bz1mb3JtYXQmZml0PWNyb3Amdz03NjQmcT04MFwiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJHYXRld2F5IEFyY2hcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTkzNTY5MjQ4ODA1LTE4MjU0MmY4MmMxND9peGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0QmYXV0bz1mb3JtYXQmZml0PWNyb3Amdz03MTUmcT04MFwiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJFc3RlcyBQYXJrXCIsXG4gICAgbGluazogXCJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTUyMDA1MDczNTA4Ny0xZWQ2NWQ5YjAyNzM/aXhsaWI9cmItNC4wLjMmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEJmF1dG89Zm9ybWF0JmZpdD1jcm9wJnc9NzM1JnE9ODBcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiR2xhY2llciBOYXRpb25hbCBQYXJrXCIsXG4gICAgbGluazogXCJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTQ3MTg5MzM3MDA1MC0yYzFhMzZjZjU1NWM/aXhsaWI9cmItNC4wLjMmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEJmF1dG89Zm9ybWF0JmZpdD1jcm9wJnc9MTE3OCZxPTgwXCIsXG4gIH0sXG5dO1xuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLmZvcm1fX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwiZm9ybV9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcImZvcm1fX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbi8vIFdyYXBwZXJzXG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIpO1xuXG4vLyBGb3Jtc1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0Rm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZWRpdC1mb3JtXCJdO1xuZXhwb3J0IGNvbnN0IGFkZENhcmRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJhZGQtZm9ybVwiXTtcbmV4cG9ydCBjb25zdCBhdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJ1cGRhdGUtYXZhdGFyLWZvcm1cIl07XG5cbi8vIEZpbmQgb3BlbiBidXR0b25zIGZvciBtb2RhbHNcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCJcbik7XG5leHBvcnQgY29uc3QgcHJvZmlsZUFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmV4cG9ydCBjb25zdCBkZWxldGVDYXJkQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gIFwiLmNhcmRzX19kZWxldGUtYnV0dG9uXCJcbik7XG5leHBvcnQgY29uc3QgcHJvZmlsZUF2YXRhckVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wcm9maWxlX19hdmF0YXItZWRpdFwiXG4pO1xuXG4vLyBFZGl0IFByb2ZpbGUgSW5wdXRzXG5leHBvcnQgY29uc3QgaW5wdXROYW1lID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX2lucHV0X25hbWVcIik7XG5leHBvcnQgY29uc3QgaW5wdXREZXNjcmlwdGlvbiA9IHByb2ZpbGVFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIuZm9ybV9faW5wdXRfZGVzY3JpcHRpb25cIlxuKTtcbiIsImltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IHtcbiAgY29uZmlnLFxuICBwcm9maWxlRWRpdEZvcm0sXG4gIGFkZENhcmRGb3JtLFxuICBwcm9maWxlRWRpdEJ1dHRvbixcbiAgaW5wdXROYW1lLFxuICBpbnB1dERlc2NyaXB0aW9uLFxuICBwcm9maWxlQWRkQnV0dG9uLFxuICBwcm9maWxlQXZhdGFyRWRpdCxcbiAgYXZhdGFyRm9ybSxcbn0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcblxubGV0IGNhcmRMaXN0O1xubGV0IG5ld0NhcmQ7XG5cbi8vIEZ1bmN0aW9uc1xuZnVuY3Rpb24gcmVuZGVyQ2FyZChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChkYXRhKTtcbiAgY2FyZExpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVJbWFnZUNsaWNrKG5hbWUsIGxpbmspIHtcbiAgY2FyZFBvcHVwLm9wZW4obmFtZSwgbGluayk7XG59XG5cbi8vIExpa2UgQ2FyZCBGdW5jdGlvbmFsaXR5XG5mdW5jdGlvbiBoYW5kbGVMaWtlQ2xpY2soY2FyZCkge1xuICBpZiAoIWNhcmQuaXNMaWtlZCgpKSB7XG4gICAgYXBpXG4gICAgICAubGlrZUNhcmQoY2FyZC5faWQpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIGNhcmQuc2V0SXNMaWtlZChyZXMuaXNMaWtlZCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXBpXG4gICAgICAucmVtb3ZlTGlrZUNhcmQoY2FyZC5faWQpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIGNhcmQuc2V0SXNMaWtlZChyZXMuaXNMaWtlZCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG4gIH1cbn1cblxuY29uc3QgY3JlYXRlQ2FyZCA9IChjYXJkT2JqZWN0KSA9PiB7XG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcbiAgICBjYXJkT2JqZWN0LFxuICAgIFwiI2NhcmRzX19saXN0LWl0ZW1cIixcbiAgICBoYW5kbGVJbWFnZUNsaWNrLFxuICAgIGhhbmRsZURlbGV0ZUNsaWNrLFxuICAgIGhhbmRsZUxpa2VDbGlja1xuICApO1xuICByZXR1cm4gY2FyZC5nZXRWaWV3KCk7XG59O1xuXG4vLyBlbmFibGUgdXNlckluZm9cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcbiAgdXNlck5hbWU6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gIHVzZXJBYm91dDogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbiAgdXNlckF2YXRhcjogXCIucHJvZmlsZV9fYXZhdGFyXCIsXG59KTtcblxuLy8gZW5hYmxlIEFQSSBjYWxsc1xuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiYTkzZWJkMmYtZmQwNi00OTlmLWIyZjktNzRlMmY4NTE5NzA5XCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuLy8gUmVuZGVyIHVzZXIgaW5mbyBhbmQgY2FyZHMgb24gcGFnZSBsb2FkXG5Qcm9taXNlLmFsbChbYXBpLmdldFVzZXIoKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcbiAgLnRoZW4oKFtkYXRhLCBjYXJkc10pID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7IG5hbWU6IGRhdGEubmFtZSwgYWJvdXQ6IGRhdGEuYWJvdXQgfSk7XG4gICAgdXNlckluZm8uc2V0VXNlckF2YXRhcihkYXRhLmF2YXRhciwgZGF0YS5uYW1lKTtcbiAgICBjYXJkTGlzdCA9IG5ldyBTZWN0aW9uKFxuICAgICAgeyBkYXRhOiBjYXJkcywgcmVuZGVyZXI6IHJlbmRlckNhcmQgfSxcbiAgICAgIFwiLmNhcmRzX19saXN0XCJcbiAgICApO1xuICAgIGNhcmRMaXN0LnJlbmRlckl0ZW1zKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcblxuLy8gZW5hYmxpbmcgdmFsaWRhdGlvbiBieSBjYWxsaW5nIGVuYWJsZVZhbGlkYXRpb24oKVxuY29uc3QgZWRpdEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIHByb2ZpbGVFZGl0Rm9ybSk7XG5lZGl0Rm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGFkZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIGFkZENhcmRGb3JtKTtcbmFkZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBhdmF0YXJGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uZmlnLCBhdmF0YXJGb3JtKTtcbmF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vLyBFZGl0aW5nIFByb2ZpbGUgSW50ZXJhY3Rpb25cbi8vIEVkaXQgUHJvZmlsZSBJbmZvcm1hdGlvblxuY29uc3QgZWRpdFByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiLCAoZGF0YSkgPT4ge1xuICBlZGl0UHJvZmlsZVBvcHVwLnNldFN1Ym1pdFRleHQodHJ1ZSk7XG4gIGFwaVxuICAgIC51cGRhdGVQcm9maWxlKGRhdGEpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKGRhdGEpO1xuICAgICAgZWRpdFByb2ZpbGVQb3B1cC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4gZWRpdFByb2ZpbGVQb3B1cC5zZXRTdWJtaXRUZXh0KGZhbHNlKSk7XG59KTtcbmVkaXRQcm9maWxlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy8gT24gY2xpY2sgZXZlbnQgZm9yIGVkaXRQcm9maWxlIGJ1dHRvblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdFByb2ZpbGVQb3B1cC5vcGVuKCk7XG4gIGNvbnN0IHVzZXJEYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgaW5wdXROYW1lLnZhbHVlID0gdXNlckRhdGEubmFtZTtcbiAgaW5wdXREZXNjcmlwdGlvbi52YWx1ZSA9IHVzZXJEYXRhLmFib3V0O1xufSk7XG5cbi8vIE5ldyBDYXJkIEludGVyYWN0aW9uXG4vLyBBZGQgbmV3IGNhcmRcbmNvbnN0IG5ld0NhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBcIiNwcm9maWxlLWFkZC1tb2RhbFwiLFxuICAoeyB0aXRsZSwgaW1hZ2UgfSkgPT4ge1xuICAgIG5ld0NhcmRQb3B1cC5zZXRTdWJtaXRUZXh0KHRydWUpO1xuICAgIGFwaVxuICAgICAgLmFkZENhcmQodGl0bGUsIGltYWdlKVxuICAgICAgLnRoZW4oKGNhcmQpID0+IHtcbiAgICAgICAgbmV3Q2FyZCA9IGNyZWF0ZUNhcmQoe1xuICAgICAgICAgIG5hbWU6IGNhcmQubmFtZSxcbiAgICAgICAgICBsaW5rOiBjYXJkLmxpbmssXG4gICAgICAgICAgX2lkOiBjYXJkLl9pZCxcbiAgICAgICAgICBpc0xpa2VkOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNhcmRMaXN0LmFkZEl0ZW0obmV3Q2FyZCk7XG4gICAgICAgIG5ld0NhcmRQb3B1cC5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbmV3Q2FyZFBvcHVwLnNldFN1Ym1pdFRleHQoZmFsc2UpKTtcbiAgfVxuKTtcbm5ld0NhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBPbiBjbGljayBldmVudCBmb3IgYWRkQ2FyZCBidXR0b25cbnByb2ZpbGVBZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYWRkRm9ybVZhbGlkYXRvci5kaXNhYmxlQnV0dG9uKCk7XG4gIG5ld0NhcmRQb3B1cC5vcGVuKCk7XG59KTtcblxuLy8gUHJvZmlsZSBQaWN0dXJlIEludGVyYWN0aW9uXG4vLyBVcGRhdGUgUHJvZmlsZSBQaWN0dXJlXG5jb25zdCB1cGRhdGVBdmF0YXJQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3VwZGF0ZS1hdmF0YXItbW9kYWxcIiwgKGltYWdlKSA9PiB7XG4gIHVwZGF0ZUF2YXRhclBvcHVwLnNldFN1Ym1pdFRleHQodHJ1ZSk7XG4gIGFwaVxuICAgIC51cGRhdGVQcm9maWxlUGljdHVyZShpbWFnZS5pbWFnZSlcbiAgICAudGhlbigodXNlckRhdGEpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlckRhdGEuYXZhdGFyKTtcbiAgICAgIHVwZGF0ZUF2YXRhclBvcHVwLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiB1cGRhdGVBdmF0YXJQb3B1cC5zZXRTdWJtaXRUZXh0KGZhbHNlKSk7XG59KTtcbnVwZGF0ZUF2YXRhclBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vIE9uIGNsaWNrIGV2ZW50IGZvciB1cGRhdGUgcHJvZmlsZSBwaWN0dXJlXG5wcm9maWxlQXZhdGFyRWRpdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhdmF0YXJGb3JtVmFsaWRhdG9yLmRpc2FibGVCdXR0b24oKTtcbiAgdXBkYXRlQXZhdGFyUG9wdXAub3BlbigpO1xufSk7XG5cbi8vIEV4aXN0aW5nIENhcmQgSW50ZXJhY3Rpb25cbi8vIFpvb20gaW4gb24gY2FyZCBpbWFnZVxuY29uc3QgY2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiI2NhcmQtbW9kYWxcIik7XG5jYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy8gRGVsZXRlIENhcmQgUG9wdXBcbmNvbnN0IGRlbGV0ZUNhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtKFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpO1xuZGVsZXRlQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNsaWNrKGNhcmQpIHtcbiAgZGVsZXRlQ2FyZFBvcHVwLm9wZW4oKTtcbiAgZGVsZXRlQ2FyZFBvcHVwLnNldFN1Ym1pdEFjdGlvbigoKSA9PiB7XG4gICAgZGVsZXRlQ2FyZFBvcHVwLnNldFN1Ym1pdFRleHQodHJ1ZSwgXCJEZWxldGluZy4uLlwiKTtcbiAgICBhcGlcbiAgICAgIC5kZWxldGVDYXJkKGNhcmQuX2lkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBkZWxldGVDYXJkUG9wdXAuY2xvc2UoKTtcbiAgICAgICAgY2FyZC5oYW5kbGVEZWxldGVDYXJkKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcbiAgICAgIC5maW5hbGx5KCgpID0+IGRlbGV0ZUNhcmRQb3B1cC5zZXRTdWJtaXRUZXh0KGZhbHNlKSk7XG4gIH0pO1xufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IHVzZXJOYW1lLCB1c2VyQWJvdXQsIHVzZXJBdmF0YXIgfSkge1xuICAgIHRoaXMuX3VzZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyTmFtZSk7XG4gICAgdGhpcy5fdXNlckFib3V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyQWJvdXQpO1xuICAgIHRoaXMuX3VzZXJBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJBdmF0YXIpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuX3VzZXJOYW1lLnRleHRDb250ZW50LFxuICAgICAgYWJvdXQ6IHRoaXMuX3VzZXJBYm91dC50ZXh0Q29udGVudCxcbiAgICB9O1xuICB9XG5cbiAgc2V0VXNlckluZm8oZGF0YSkge1xuICAgIHRoaXMuX3VzZXJOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX3VzZXJBYm91dC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgdGhpcy5fdXNlckF2YXRhci5hbHQgPSBkYXRhLm5hbWUgKyBcIiBhdmF0YXJcIjtcbiAgfVxuXG4gIHNldFVzZXJBdmF0YXIoaW1hZ2UsIG5hbWUpIHtcbiAgICB0aGlzLl91c2VyQXZhdGFyLnNyYyA9IGltYWdlO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIC8vIGNvbnN0cnVjdG9yIGJvZHlcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9hdXRob3JpemF0aW9uID0gaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICAgIHRoaXMuX2NvbnRlbnRUeXBlID0gaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiXTtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH0gZWxzZSBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICAvLyBvdGhlciBtZXRob2RzIGZvciB3b3JraW5nIHdpdGggdGhlIEFQSVxuICBnZXRVc2VyKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHVwZGF0ZVByb2ZpbGUoZGF0YSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXG4gICAgICAgIGFib3V0OiBkYXRhLmFib3V0LFxuICAgICAgfSksXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBhZGRDYXJkKHRpdGxlLCBsaW5rKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZTogdGl0bGUsXG4gICAgICAgIGxpbms6IGxpbmssXG4gICAgICB9KSxcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBsaWtlQ2FyZChpZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHJlbW92ZUxpa2VDYXJkKGlkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgdXBkYXRlUHJvZmlsZVBpY3R1cmUobGluaykge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcjogbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcbiAgICB0aGlzLl9jYXJkSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbiAgICB0aGlzLl9jYXJkVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX190aXRsZVwiKTtcbiAgfVxuXG4gIG9wZW4oZGF0YSkge1xuICAgIHRoaXMuX2NhcmRJbWFnZS5zcmMgPSBkYXRhLnVybDtcbiAgICB0aGlzLl9jYXJkVGl0bGUudGV4dENvbnRlbnQgPSBkYXRhLnRpdGxlO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSBkYXRhLnRpdGxlO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbmZpcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICBzdXBlcih7IHBvcHVwU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fcG9wdXBDb25maXJtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5fcG9wdXBTdWJtaXQgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uXCIpO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXBDb25maXJtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCgpO1xuICAgIH0pO1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBzZXRTdWJtaXRUZXh0KHN1Ym1pdCwgc3VibWl0VGV4dCA9IFwiU2F2aW5nLi4uXCIpIHtcbiAgICBpZiAoc3VibWl0KSB7XG4gICAgICB0aGlzLl9wb3B1cFN1Ym1pdC50ZXh0Q29udGVudCA9IHN1Ym1pdFRleHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3BvcHVwU3VibWl0LnRleHRDb250ZW50ID0gXCJZZXNcIjtcbiAgICB9XG4gIH1cblxuICBzZXRTdWJtaXRBY3Rpb24oYWN0aW9uKSB7XG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gYWN0aW9uO1xuICB9XG59XG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImhhbmRsZUxpa2VDbGljayIsIm5hbWUiLCJsaW5rIiwiX2lkIiwiaXNMaWtlZCIsInRoaXMiLCJfbmFtZSIsIl9saW5rIiwiX2lzTGlrZWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfaGFuZGxlTGlrZUNsaWNrIiwiX2dldENhcmRFbGVtZW50IiwiX2NhcmRFbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9zZXRFdmVudHNMaXN0ZW5lcnMiLCJfY2FyZEltYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInVybCIsIl9saWtlQnV0dG9uIiwiX2RlbGV0ZUJ1dHRvbiIsImhhbmRsZURlbGV0ZUNhcmQiLCJyZW1vdmUiLCJzZXRJc0xpa2VkIiwibGlrZWRTdGF0dXMiLCJfcmVuZGVyTGlrZXMiLCJjbGFzc0xpc3QiLCJhZGQiLCJnZXRWaWV3IiwiX2NhcmRUaXRsZSIsInNyYyIsInRleHRDb250ZW50IiwiYWx0IiwiU2VjdGlvbiIsInNlbGVjdG9yIiwiZGF0YSIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsImNsZWFyIiwiaW5uZXJIVE1MIiwicmVuZGVySXRlbXMiLCJyZXZlcnNlIiwiZm9yRWFjaCIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cEVsZW1lbnQiLCJvcGVuIiwiX2hhbmRsZUVzY0Nsb3NlIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZSIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX3BvcHVwRm9ybSIsIl9pbnB1dExpc3QiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfcG9wdXBTdWJtaXQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwic2V0U3VibWl0VGV4dCIsInN1Ym1pdCIsInN1Ym1pdFRleHQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJwcmV2ZW50RGVmYXVsdCIsInJlc2V0IiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybSIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9mb3JtIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwiaWQiLCJfaGlkZUlucHV0RXJyb3IiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJfaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsIl9lbmFibGVCdXR0b24iLCJfc3VibWl0QnV0dG9uIiwiZGlzYWJsZWQiLCJldmVyeSIsInZhbGlkaXR5IiwidmFsaWQiLCJfY2hlY2tWYWxpZGl0eSIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZW5hYmxlVmFsaWRhdGlvbiIsImV2dCIsImNvbmZpZyIsImZvcm1TZWxlY3RvciIsInByb2ZpbGVFZGl0TW9kYWwiLCJwcm9maWxlRWRpdEZvcm0iLCJmb3JtcyIsImFkZENhcmRGb3JtIiwiYXZhdGFyRm9ybSIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZUFkZEJ1dHRvbiIsInByb2ZpbGVBdmF0YXJFZGl0IiwiaW5wdXROYW1lIiwiaW5wdXREZXNjcmlwdGlvbiIsImNhcmRMaXN0IiwibmV3Q2FyZCIsInJlbmRlckNhcmQiLCJjYXJkRWxlbWVudCIsImNyZWF0ZUNhcmQiLCJjYXJkUG9wdXAiLCJjYXJkIiwiYXBpIiwicmVtb3ZlTGlrZUNhcmQiLCJ0aGVuIiwicmVzIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJsaWtlQ2FyZCIsImNhcmRPYmplY3QiLCJ1c2VySW5mbyIsInVzZXJOYW1lIiwidXNlckFib3V0IiwidXNlckF2YXRhciIsIl91c2VyTmFtZSIsIl91c2VyQWJvdXQiLCJfdXNlckF2YXRhciIsImdldFVzZXJJbmZvIiwiYWJvdXQiLCJzZXRVc2VySW5mbyIsInNldFVzZXJBdmF0YXIiLCJpbWFnZSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfYXV0aG9yaXphdGlvbiIsImF1dGhvcml6YXRpb24iLCJfY29udGVudFR5cGUiLCJfaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwiZ2V0VXNlciIsInVwZGF0ZVByb2ZpbGUiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJ0aXRsZSIsImRlbGV0ZUNhcmQiLCJ1cGRhdGVQcm9maWxlUGljdHVyZSIsImF2YXRhciIsImFsbCIsImNhcmRzIiwibG9nIiwiYWRkRm9ybVZhbGlkYXRvciIsImF2YXRhckZvcm1WYWxpZGF0b3IiLCJlZGl0UHJvZmlsZVBvcHVwIiwiZmluYWxseSIsInVzZXJEYXRhIiwibmV3Q2FyZFBvcHVwIiwiX3JlZjIiLCJ1cGRhdGVBdmF0YXJQb3B1cCIsImRlbGV0ZUNhcmRQb3B1cCIsIl9wb3B1cENvbmZpcm0iLCJfaGFuZGxlU3VibWl0Iiwic2V0U3VibWl0QWN0aW9uIiwiYWN0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==